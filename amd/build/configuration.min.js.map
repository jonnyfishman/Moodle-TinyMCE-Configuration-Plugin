{"version":3,"file":"configuration.min.js","sources":["../src/configuration.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tiny Media Manager configuration.\n *\n * @module      tiny_configurator/configuration\n * @copyright   2022, Stevani Andolo  <stevani@hotmail.com.au>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n// import {accessbilityButtonName} from './common';\n\nimport {\n  removeToolbarButton\n} from 'editor_tiny/utils';\n\nimport {component} from './common';\n\nexport const configure = async (instanceConfig) => {\n\n  // use async IIFE to wait for object elements to be added\n  const pluginParams = await (async () => {\n    const pluginName = `${component}/plugin:data`;\n\n    while (!instanceConfig[pluginName]) {\n      await new Promise(resolve => setTimeout(resolve, 100));\n    }\n\n    return instanceConfig[pluginName].params;\n  })();\n\n  // could this be sped up by removing elements from params as they are used?\n\n  // remove toolbar items\n  const buttonsToRemove = pluginParams.disabledToolbarButtons.split(' ');\n  buttonsToRemove.forEach(button => {\n\n    if( button.includes(\":\") ) { // remove button\n      const parts = button.split(':');\n      instanceConfig.toolbar = removeToolbarButton(instanceConfig.toolbar, parts[0], parts[1]);\n\n    } else { // remove button menu\n      instanceConfig.toolbar = instanceConfig.toolbar.filter(function (toolbarItem) {\n          return toolbarItem.name !== button;\n      });\n\n    }\n  });\n\n  // remove menu items\n  const menusToRemove = pluginParams.disabledMenuItems.split(' ');\n\n  menusToRemove.forEach(menuName => {\n\n    if( menuName.includes(\":\") ) { // remove menu item\n      const parts = menuName.split(':');\n      instanceConfig.menu[parts[0]].items = instanceConfig.menu[parts[0]].items.replace(parts[1], '');\n\n    } else { // remove menu\n      for (const name in instanceConfig.menu) {\n        if (instanceConfig.menu[name] === menuName) {\n          delete instanceConfig.menu[name];\n          break;\n        }\n      }\n    }\n  });\n\n  // These come from editor.js in parent\n  /*\n  // This could be tweaked to change the colours to match the theme etc.\n  if (instanceConfig.menu.format) {\n      instanceConfig.menu.format.items = instanceConfig.menu.format.items\n          // Remove forecolor and backcolor.\n          .replace(/forecolor ?/, '')\n          .replace(/backcolor ?/, '')\n\n          // Remove fontfamily for now.\n          .replace(/fontfamily ?/, '')\n\n          // Remove fontsize for now.\n          .replace(/fontsize ?/, '')\n\n          // Remove styles - it just duplicates the format menu in a way which does not respect configuration\n          .replace(/styles ?/, '')\n\n          // Remove any duplicate separators.\n          .replaceAll(/\\| *\\|/g, '|');\n  }\n  */\n\n  // This removes a menu item intirely from the menu bar\n  if (instanceConfig.menu.edit) {\n      // instanceConfig.menu.edit.items = '';\n  }\n  console.log(instanceConfig);\n  return instanceConfig;\n\n};\n"],"names":["async","pluginParams","pluginName","component","instanceConfig","Promise","resolve","setTimeout","params","disabledToolbarButtons","split","forEach","button","includes","parts","toolbar","filter","toolbarItem","name","disabledMenuItems","menuName","menu","items","replace","edit","console","log"],"mappings":"4NA+ByBA,MAAAA,uBAGjBC,kBAAqB,iBACnBC,qBAAgBC,wCAEdC,eAAeF,mBACf,IAAIG,SAAQC,SAAWC,WAAWD,QAAS,cAG5CF,eAAeF,YAAYM,QAPT,GAaHP,aAAaQ,uBAAuBC,MAAM,KAClDC,SAAQC,YAElBA,OAAOC,SAAS,KAAO,OACnBC,MAAQF,OAAOF,MAAM,KAC3BN,eAAeW,SAAU,8BAAoBX,eAAeW,QAASD,MAAM,GAAIA,MAAM,SAGrFV,eAAeW,QAAUX,eAAeW,QAAQC,QAAO,SAAUC,oBACtDA,YAAYC,OAASN,oBAOdX,aAAakB,kBAAkBT,MAAM,KAE7CC,SAAQS,cAEhBA,SAASP,SAAS,KAAO,OACrBC,MAAQM,SAASV,MAAM,KAC7BN,eAAeiB,KAAKP,MAAM,IAAIQ,MAAQlB,eAAeiB,KAAKP,MAAM,IAAIQ,MAAMC,QAAQT,MAAM,GAAI,aAGvF,MAAMI,QAAQd,eAAeiB,QAC5BjB,eAAeiB,KAAKH,QAAUE,SAAU,QACnChB,eAAeiB,KAAKH,gBA+B/Bd,eAAeiB,KAAKG,KAGxBC,QAAQC,IAAItB,gBACLA"}